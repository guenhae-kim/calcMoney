<!DOCTYPE html>
<html lang="ko">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="UTF-8">
  <title>ì „ì„¸ vs ë°˜ì „ì„¸ ë¹„êµ ê³„ì‚°ê¸°</title>
  <style>
    html, body {
      margin: 0;
      padding: 16px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      font-size: 15px;
      line-height: 1.6;
      background-color: #f5f5f5;
      color: #111;
      max-width: 100%;
      overflow-x: hidden;
    }
    h1 {
      font-size: 1.25rem;
      margin-bottom: 1rem;
      font-weight: 700;
    }
    h3 {
      font-size: 1.1rem;
      margin-top: 1.5rem;
      font-weight: 600;
    }
    label {
      font-weight: 600;
      display: block;
      margin: 0.75rem 0 0.3rem;
    }
    input {
      width: 100%;
      padding: 7px;
      font-size: 15px;
      margin-bottom: 1rem;
      border: 1px solid #ddd;
      border-radius: 8px;
      box-sizing: border-box;
      background: #fff;
      text-align: center;
    }
    .highlight {
      font-weight: 700;
      color: #007aff;
    }
    .result {
      margin-top: 24px;
      padding: 16px;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 10px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.05);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 14px;
    }
    th, td {
      border: 1px solid #e0e0e0;
      padding: 10px;
      text-align: left;
    }
    th {
      background: #f7f7f7;
    }
    canvas {
      margin-top: 24px;
      width: 100% !important;
      height: 1000px;
      display: block;
    }
    p, ul {
      margin: 0.5rem 0;
    }
    ul {
      padding-left: 1.2rem;
    }
  </style>
</head>
<body>
  <h1>ì „ì„¸ vs ë°˜ì „ì„¸ ë¹„êµ ê³„ì‚°ê¸°</h1>

  <p><strong>ê³„ì‚° ì¡°ê±´ ì„¤ëª…:</strong></p>
  <ul>
    <li>(ì„ í˜œ+ê·¼í•´) ë³´ìœ  í˜„ê¸ˆ: 4ì–µ</li>
    <li>(ì„ í˜œ) ì‹ ìš©ëŒ€ì¶œ: 1.5ì–µ (ì´ììœ¨ ì—° 1%)</li>
    <li>ì‹ ìš©ëŒ€ì¶œ ë¨¼ì € ì‚¬ìš©, ê·¸ í›„ ë¶€ì¡±ê¸ˆì•¡ì€ ì „ì„¸ëŒ€ì¶œ</li>
    <li>(ê·¼í•´) ì „ì„¸ëŒ€ì¶œ ìš°ëŒ€ ì¡°ê±´: ìµœëŒ€ 2ì–µê¹Œì§€, ì‹œì¤‘ê¸ˆë¦¬ì—ì„œ 2% ê°ë©´</li>
    <li>(ê·¼í•´) ê·¸ ì™¸ ê¸ˆì•¡ì€ ì‹œì¤‘ê¸ˆë¦¬ ê·¸ëŒ€ë¡œ ì ìš©</li>
  </ul>

  <div>
     <div style="margin-bottom: 1rem; display: flex; align-items: center; gap: 8px; font-weight: 800;">
      <span style="min-width: 130px; text-align: right;">[ì „ì„¸] ì „ì„¸ê¸ˆì•¡:</span>
      <input id="option1Jeonse" type="number" step="0.1" value="8.3" style="width: 120px;">
      <span>ì–µ</span>
    </div>

    <div style="margin-bottom: 1rem; display: flex; align-items: center; gap: 8px; font-weight: 800;">
      <span style="min-width: 130px; text-align: right;">[ë°˜ì „ì„¸] ë³´ì¦ê¸ˆ ê¸ˆì•¡:</span>
      <input id="option2Deposit" type="number" step="0.1" value="6" style="width: 120px;text-align:center">
      <span>ì–µ</span>
    </div>

     <div style="margin-bottom: 1rem; display: flex; align-items: center; gap: 8px; font-weight: 800;">
      <span style="min-width: 130px; text-align: right;">[ë°˜ì „ì„¸] ì›”ì„¸ ê¸ˆì•¡:</span>
      <input id="option2Rent" type="number" value="70" style="width: 100px;">
      <span>ë§Œì›</span>
    </div>

     <div style="margin-bottom: 1rem; display: flex; align-items: center; gap: 8px; font-weight: 800;">
      <span style="min-width: 130px; text-align: right;">ì „ì„¸ëŒ€ì¶œ ê¸ˆë¦¬:</span>
      <input id="marketRate" type="number" step="0.1" value="4.5" style="width: 120px;">
      <span>%</span>
    </div>

    <p class="highlight" id="summaryText" style="font-size: 16px; background: #eef5ff; padding: 10px; border-radius: 8px;"> </p>
  </div>

  <div class="result" id="result"></div>
  <canvas id="rateChart" width="800" height="800"></canvas>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const OWN_CASH = 4e8;
    const CREDIT_LOAN = 1.5e8;
    const CREDIT_INTEREST = 0.01;
    const MAX_PREFERRED_LOAN = 2e8;
    const PREFERRED_DISCOUNT = 0.02;

    let chartInstance = null; // ğŸ’¡ ê·¸ë˜í”„ ì¸ìŠ¤í„´ìŠ¤ ì €ì¥ìš©
    const formatMoney = (num) => Math.round(num).toLocaleString() + 'ì›';
    const formatEok = (num) => (num / 1e8).toFixed(2) + 'ì–µ';

    document.querySelectorAll('input').forEach(el => {
      el.addEventListener('input', () => {
        updateSummary();
        calculate();
      });
    });

    function updateSummary() {
      const opt1 = document.getElementById("option1Jeonse").value;
      const opt2 = document.getElementById("option2Deposit").value;
      const rent = document.getElementById("option2Rent").value;
      const rate = document.getElementById("marketRate").value;
      document.getElementById("summaryText").innerHTML = `<span class='highlight'>(ì „ì„¸ ê¸ˆë¦¬ ${rate}% ì ìš©) <br> ì „ì„¸ ${opt1}ì–µ  VS ë°˜ì „ì„¸ ${opt2}ì–µ / ${Number(rent).toLocaleString()}ë§Œì› </span>`;
    }

    function calculate() {
      const option1Jeonse = parseFloat(document.getElementById("option1Jeonse").value) * 1e8;
      const option2Deposit = parseFloat(document.getElementById("option2Deposit").value) * 1e8;
      const option2Rent = parseFloat(document.getElementById("option2Rent").value) * 10000;
      const baseRate = parseFloat(document.getElementById("marketRate").value);

      const totalMoney = OWN_CASH + CREDIT_LOAN;

      const getLoanInterestBreakdown = (needAmount, marketRate) => {
        let preferred = Math.min(needAmount, MAX_PREFERRED_LOAN);
        let normal = Math.max(needAmount - MAX_PREFERRED_LOAN, 0);
        let preferredInterest = preferred * (marketRate - PREFERRED_DISCOUNT);
        let normalInterest = normal * marketRate;
        return preferredInterest + normalInterest;
      };

      const runCalc = (rate) => {
        const marketRate = rate / 100;

        const need1 = option1Jeonse - totalMoney;
        const interest1 = (need1 > 0 ? getLoanInterestBreakdown(need1, marketRate) : 0) + CREDIT_LOAN * CREDIT_INTEREST;

        const need2 = option2Deposit - totalMoney;
        const interest2 = (need2 > 0 ? getLoanInterestBreakdown(need2, marketRate) : 0) + CREDIT_LOAN * CREDIT_INTEREST + option2Rent * 12;

        return { rate, interest1, interest2 };
      };

      const baseData = runCalc(baseRate);

      let resultHTML = `<h3>ê¸°ì¤€ ê¸ˆë¦¬ ${baseRate}% ê¸°ì¤€ ê²°ê³¼</h3>`;
      resultHTML += `<p>ì „ì„¸ ì—° ë¹„ìš©: <strong>${formatMoney(baseData.interest1)}</strong></p>`;
      resultHTML += `<p>ë°˜ì „ì„¸ ì—° ë¹„ìš©: <strong>${formatMoney(baseData.interest2)}</strong></p>`;
      resultHTML += `<p class='highlight'>ğŸ‘‰ ${baseData.interest1 < baseData.interest2 ? 'ì „ì„¸ê°€ ë” ìœ ë¦¬í•¨' : 'ë°˜ì „ì„¸ê°€ ë” ìœ ë¦¬í•¨'}</p>`;

      // ê¸ˆë¦¬ ë³€í™” ê·¸ë˜í”„ ë°ì´í„°
      const range = 10;
      const labels = [];
      const jeonseCosts = [];
      const banjeonseCosts = [];

      for (let i = -range; i <= range; i++) {
        const r = +(baseRate + i * 0.1).toFixed(1);
        const data = runCalc(r);
        labels.push((r === baseRate ? r + '% (ê¸°ì¤€)' : r + '%'));
        jeonseCosts.push(Math.round(data.interest1));
        banjeonseCosts.push(Math.round(data.interest2));
      }

      const diff = Math.abs(baseData.interest1 - baseData.interest2);
      const cheaper = baseData.interest1 < baseData.interest2 ? 'ì „ì„¸' : 'ë°˜ì „ì„¸';
      const moreExpensive = cheaper === 'ì „ì„¸' ? 'ë°˜ì „ì„¸' : 'ì „ì„¸';
      document.getElementById("result").innerHTML = `
        <h3>ì˜µì…˜1. ì „ì„¸ ${(option1Jeonse / 1e8).toFixed(1)}ì–µ</h3>
        <table>
          <tr><th>êµ¬ë¶„</th><th>ê¸ˆì•¡</th><th>ê³„ì‚°ì‹</th></tr>
          <tr><td>ì‹ ìš©ëŒ€ì¶œ ì´ì</td><td>${formatMoney(CREDIT_LOAN * CREDIT_INTEREST)}</td><td>1.5ì–µ Ã— 1%</td></tr>
          <tr><td>ìš°ëŒ€ê¸ˆë¦¬ ì „ì„¸ëŒ€ì¶œ ì´ì</td><td>${formatMoney(Math.min(option1Jeonse - totalMoney, MAX_PREFERRED_LOAN) * (baseRate - 2) / 100)}</td><td>${formatEok(Math.min(option1Jeonse - totalMoney, MAX_PREFERRED_LOAN))} Ã— ${(baseRate - 2)}%</td></tr>
          <tr><td>ì¼ë°˜ê¸ˆë¦¬ ì „ì„¸ëŒ€ì¶œ ì´ì</td><td>${formatMoney(Math.max(option1Jeonse - totalMoney - MAX_PREFERRED_LOAN, 0) * baseRate / 100)}</td><td>${formatEok(Math.max(option1Jeonse - totalMoney - MAX_PREFERRED_LOAN, 0))} Ã— ${baseRate}%</td></tr>
          <tr><td>ì´ ì—° ì´ì</td><td>${formatMoney(baseData.interest1)}</td><td>ì‹ ìš© + ì „ì„¸ëŒ€ì¶œ</td></tr>
          <tr><td>ì›” ë¹„ìš©</td><td>${formatMoney(baseData.interest1 / 12)}</td><td>ì´ ì´ì Ã· 12</td></tr>
        </table>

        <h3>ì˜µì…˜2. ë°˜ì „ì„¸ ${(option2Deposit / 1e8).toFixed(1)}ì–µ / ${formatMoney(option2Rent)}</h3>
        <table>
          <tr><th>êµ¬ë¶„</th><th>ê¸ˆì•¡</th><th>ê³„ì‚°ì‹</th></tr>
          <tr><td>ì‹ ìš©ëŒ€ì¶œ ì´ì</td><td>${formatMoney(CREDIT_LOAN * CREDIT_INTEREST)}</td><td>1.5ì–µ Ã— 1%</td></tr>
          <tr><td>ìš°ëŒ€ê¸ˆë¦¬ ì „ì„¸ëŒ€ì¶œ ì´ì</td><td>${formatMoney(Math.min(option2Deposit - totalMoney, MAX_PREFERRED_LOAN) * (baseRate - 2) / 100)}</td><td>${formatEok(Math.min(option2Deposit - totalMoney, MAX_PREFERRED_LOAN))} Ã— ${(baseRate - 2)}%</td></tr>
          <tr><td>ì¼ë°˜ê¸ˆë¦¬ ì „ì„¸ëŒ€ì¶œ ì´ì</td><td>${formatMoney(Math.max(option2Deposit - totalMoney - MAX_PREFERRED_LOAN, 0) * baseRate / 100)}</td><td>${formatEok(Math.max(option2Deposit - totalMoney - MAX_PREFERRED_LOAN, 0))} Ã— ${baseRate}%</td></tr>
          <tr><td>ì›”ì„¸ ë¹„ìš©</td><td>${formatMoney(option2Rent * 12)}</td><td>${formatMoney(option2Rent)} Ã— 12</td></tr>
          <tr><td>ì´ ì—° ë¹„ìš©</td><td>${formatMoney(baseData.interest2)}</td><td>ì´ì + ì›”ì„¸</td></tr>
          <tr><td>ì›” ë¹„ìš©</td><td>${formatMoney(baseData.interest2 / 12)}</td><td>ì´ ë¹„ìš© Ã· 12</td></tr>
        </table>

        <h3>ë¹„êµ</h3>
        <table>
          <tr><th>êµ¬ë¶„</th><th>ì´ ìœµìì•¡</th><th>ì—° ë¹„ìš©</th><th>ì›” ë¹„ìš©</th></tr>
          <tr><td>ì „ì„¸</td><td>${formatEok(option1Jeonse - totalMoney)}</td><td>${formatMoney(baseData.interest1)}</td><td>${formatMoney(baseData.interest1 / 12)}</td></tr>
          <tr><td>ë°˜ì „ì„¸</td><td>${formatEok(option2Deposit - totalMoney)}</td><td>${formatMoney(baseData.interest2)}</td><td>${formatMoney(baseData.interest2 / 12)}</td></tr>
        </table>

        <p class='highlight'>ğŸ‘‰ ${cheaper}ê°€ ë” ìœ ë¦¬í•¨ (í•œë‹¬ì— ${formatMoney(diff/12)} ì°¨ì´ë‚¨)</p>`;

      if (chartInstance){
        chartInstance.destroy();
      }

      chartInstance = new Chart(document.getElementById('rateChart'), {
        type: 'line',
        data: {
          labels: labels,
          datasets: [
            {
              label: 'ì „ì„¸ ì´ ì—° ë¹„ìš©',
              data: jeonseCosts,
              borderWidth: 2,
              fill: false
            },
            {
              label: 'ë°˜ì „ì„¸ ì´ ì—° ë¹„ìš©',
              data: banjeonseCosts,
              borderWidth: 2,
              fill: false
            }
          ]
        },
        options: {
          responsive: true,
          interaction: { mode: 'index', intersect: false },
          plugins: {
            legend: { position: 'top' },
            tooltip: { enabled: true },
            title: {
              display: true,
              text: 'ì „ì„¸ ê¸ˆë¦¬ ë³€í™”ì— ë”°ë¥¸ ë¹„ìš© ë¹„êµ (ì—° ë¹„ìš© ê¸°ì¤€)'
            }
          },
          hover: { mode: 'index', intersect: false },
          scales: {
            y: {
              ticks: {
                callback: function(value) {
                  return value.toLocaleString() + 'ì›';
                }
              }
            }
          }
        }
      });
    }

    updateSummary();
    calculate();
  </script>
</body>
</html>
